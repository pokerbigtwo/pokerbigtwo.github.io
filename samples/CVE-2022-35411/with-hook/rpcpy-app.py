from typing import Generator

import uvicorn
from typing_extensions import TypedDict

from rpcpy import RPC
import sys, traceback
from mako.template import Template

app = RPC()

@app.register
def none() -> None:
    return


@app.register
def sayhi(name: str) -> str:
    return Template("Hello ${name}").render(name=name)


@app.register
def yield_data(max_num: int) -> Generator[int, None, None]:
    for i in range(max_num):
        yield i


D = TypedDict("D", {"key": str, "other-key": str})


@app.register
def query_dict(value: str) -> D:
    return {"key": value, "other-key": value}


if __name__ == "__main__":
    uvicorn.run(app, interface="wsgi",host="0.0.0.0", port=65432)